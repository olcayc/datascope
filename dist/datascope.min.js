/*! datascope 2014-04-29 */
"use strict";function smooth(a,b,c,d,e){function f(a){for(var b=0;d>b;b++)a[b]=a[b]/s[b]}d=d||100,e=e||kernels.gaussian;var g=[],h=[],i=require("moment");if(function(){for(var d in a){var e=a[d][b],f=a[d][c],j={x:e,y:f};if("string"==typeof e){var k=i(e);k.isValid()?(j.x=k.unix(),g.push(j)):h.push(j)}else"number"==typeof e&&g.push(j)}}(),0===g.length)return{xAxis:[],xDensity:[],yMean:[],yFrequency:[]};g.sort(function(a,b){return a.x-b.x});var j=g.length,k=g[0].x,l=g[j-1].x,m=j>=100?g[Math.round(.01*j)].x:k,n=j>=100?g[Math.round(.99*j)].x:l,o=0,p=0;!function(){var a=0,b=0;for(var c in g){var d=g[c].x-o;a+=1,o+=d/a,b+=d*(g[c].x-o)}p=Math.sqrt(b/(a-1))}();var q=1.06*p*Math.pow(j,-.2),r=[],s=fillNumericArray(d,0),t=fillNumericArray(d,0),u={};!function(){for(var a=(n-m)/(d-1),b=0;d>b;b++)r.push(m+b*a)}();var v=1/q;for(var w in g){var x,y,z=g[w].x,A=g[w].y;"string"==typeof A?(u.hasOwnProperty(A)||(u[A]=fillNumericArray(d,0)),x=1,y=u[A]):(x=A,y=t);for(var B=0;d>B;B++){var C=e((r[B]-z)*v);s[B]+=C,y[B]+=C*x}}f(t);for(var D in u)f(u[D]);for(var E=0,F=0;d>F;F++)E+=s[F];for(var G=0;d>G;G++)s[G]/=E;var H={xAxis:r,xDensity:s,yMean:t,yFrequency:u};return H}function generateFakeData(a){for(var b=[],c=0;a>c;c++){for(var d={},e=1;5>=e;e++)d["x"+e]=Math.random()<.01?"Missing":Math.random();d.y1="Missing"!==d.x1&&"Missing"!==d.x2?d.x1*d.x1+.05*d.x2:"Missing",d.y2="Missing"!==d.x3?Math.sin(d.x3*Math.PI):"Missing",d.y3="Missing"!==d.x4?Math.round(10*d.x4):"Missing",b.push(d)}return b}function fillNumericArray(a,b){return Array.apply(null,new Array(a)).map(Number.prototype.valueOf,b)}var kernels={gaussian:function(a){return.3989422804*Math.exp(-.5*a*a)},epanechnikov:function(a){return 1>=a?.75*(1-a*a):0},uniform:function(a){return 1>=a?.5:0}};exports.smooth=smooth,exports.generateFakeData=generateFakeData,exports.kernels=kernels;